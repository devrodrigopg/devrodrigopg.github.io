var xreader=window.PubViewer||{accWheelX:0,accWheelY:0,wheelTime:Date.now(),inited:!1,sentMsgID:0,pageInstanceID:1,messagesAwaitingResponse:[],touchStartTime:Date.now(),touchActionDefaultPrevented:!1,touchStartX:0,touchStartY:0,touchMoves:0,draggingPage:!1,wasDraggingPage:!1,canDragPage:!1,canDragPageLeft:!1,canDragPageRight:!1,currentDragX:0,lastReaderTouchEndTime:0,lastReaderTapTime:0,containerWidth:0,containerHeight:0,isDoublePage:!0,zoom:1,pageW:0,pageH:0,pageZoom:0,isTurningPages:!1,overriddenOrientation:null,Document:{Settings:{appName:"PubCoder Project",appIdentifier:"",facingPagesInLandscape:!0,lockOrientation:!1,restoreLatestPage:!0,},Renditions:{Mobile:[],Desktop:[],},},MediaOverlay:{IsPlaying:!1,IsPlayingAudio:!1,CurrentElement:null,ActiveElementClass:"-epub-media-overlay-active",},Platform:{Web:"Web",iOS:"iOS",Android:"Android",Mac:"Mac",Windows:"Windows",Unknown:"Unknown",},Idiom:{Phone:"Phone",Tablet:"Tablet",Desktop:"Desktop",Unknown:"Unknown",},Environment:{Platform:"Unknown",Idiom:"Unknown",AppName:"Unknown",AppVersion:"0.0",CurrentUsername:null,CurrentDeviceId:null,ProductId:null,},Hooks:{_beforeNavigationHooks:[],_beforePageLoadHooks:[],_beforePagePlayHooks:[],set BeforeNavigation(hook){this._beforeNavigationHooks.push(hook)},set BeforePageLoad(hook){this._beforePageLoadHooks.push(hook)},set BeforePagePlay(hook){this._beforePagePlayHooks.push(hook)},},ReaderSettings:{EnableDoublePage:!1,EnableRightToLeft:!1,EnableSwipeToNavigate:!0,EnablePinchToZoom:!0,EnableTouchToOpenAppMenu:!0,EnableTapToSeekReadaloud:!0,ViewportFitCover:!0,},NativeStorage:{data:{},setItem:function(key,value){if(typeof key!=="string"||typeof value!=="string")return;xreader.NativeStorage.data[key]=value},getItem:function(key){if(typeof key!=="string")return null;return xreader.NativeStorage.data[key]},},getWindowZoomedByUser:function(){if(xreader.Environment.Platform==xreader.Platform.Android){return xreader.zoom>1}else if(typeof window.visualViewport!=="undefined"&&typeof window.visualViewport.scale==="number"){return window.visualViewport.scale>1}else{return document.documentElement.clientWidth-window.innerWidth>0.001}},init:function(){if(document.body==null||!app){setTimeout(function(){xreader.init()},50);return}
if(xreader.inited){return}else{xreader.inited=!0}
$("body").bind("touchstart mousedown",function(ev,iframeEvent){xreader.onTouchStart(ev,iframeEvent)});$("body").bind("touchmove",function(ev,iframeEvent){xreader.onTouchMove(ev,iframeEvent)});$("body").bind("touchend mouseup",function(ev,iframeEvent){xreader.onTouchEnd(ev,iframeEvent)});$("#container").bind("click",function(ev,iframeEvent){xreader.onTap(ev,iframeEvent)});$("#overlay").bind("touchstart mousedown",function(ev,iframeEvent){xreader.onTouchStart(ev,iframeEvent)});$("#overlay").bind("touchmove",function(ev,iframeEvent){xreader.onTouchMove(ev,iframeEvent)});$("#overlay").bind("touchend mouseup",function(e){xreader.onTouchEnd(e)});$("#overlay").bind("click",function(ev,iframeEvent){xreader.onTap(ev,iframeEvent)});$(window).bind("keydown",function(ev,iframeEvent){xreader.onKeyDown(ev,iframeEvent)});xreader.callAppMethod("Inited",[window.innerWidth,window.innerHeight]);$(window).resize(function(){xreader._lastKnownWindowInnerWidth=window.innerWidth;xreader._lastKnownWindowInnerHeight=window.innerHeight;xreader.onWindowResize()});if(xreader.Environment.Platform==xreader.Platform.Web||xreader.Environment.Idiom==xreader.Idiom.Desktop){window.setInterval(function(){if(xreader._lastKnownWindowInnerWidth!=window.innerWidth||xreader._lastKnownWindowInnerHeight!=window.innerHeight){xreader._lastKnownWindowInnerWidth=window.innerWidth;xreader._lastKnownWindowInnerHeight=window.innerHeight;if(xreader.Environment.Platform==xreader.Platform.Web){if(document.activeElement?.tagName==="textarea"||document.getElementById("ReaderPageOne")?.contentWindow?.document?.activeElement?.tagName=="textarea"||document.getElementById("ReaderPageTwo")?.contentWindow?.document?.activeElement?.tagName=="textarea"){console.log("ignoring window resize while textarea is focused");return}}
xreader.onWindowResize()}},500)}
$(window).on("wheel",function(ev,iframeEvent){xreader.onWheel(ev,iframeEvent)});window.addEventListener("message",function(event){try{var message=event.data;document.getElementById("ReaderPageOne").contentWindow.postMessage(message,"*");document.getElementById("ReaderPageTwo").contentWindow.postMessage(message,"*")}catch(error){console.error(error)}})},onWindowResize:function(){if(xreader.Environment.Platform==xreader.Platform.Web||xreader.Environment.Idiom==xreader.Idiom.Desktop){var width=window.innerWidth;var height=window.innerHeight;if(xreader.getWindowZoomedByUser()){width=document.documentElement.clientWidth;height=document.documentElement.clientHeight}
xreader.callAppMethod("WindowResize",[width,height]);return}
if((window.innerWidth>window.innerHeight&&xreader.containerWidth>xreader.containerHeight)||(window.innerWidth<window.innerHeight&&xreader.containerWidth<xreader.containerHeight)){return}else if(window.innerWidth==window.innerHeight){console.log("skipped onWindowResize at "+window.innerWidth+" x "+window.innerHeight);setTimeout(xreader.onWindowResize,10);return}
xreader.callAppMethod("WindowResize",[window.innerWidth,window.innerHeight,])},setOverriddenOrientation:function(orientation){xreader.overriddenOrientation=orientation},handleReaderTouchAction:function(e){if(e==null)return;if(e.originalEvent!=null){e=e.originalEvent}
if(e.defaultPrevented)return;if(e.type=="touchend"||e.type=="mouseup"){xreader.lastReaderTouchEndTime=Date.now()}else if(e.type=="click"){xreader.lastReaderTapTime=Date.now()}else{return}
if(Math.abs(xreader.lastReaderTouchEndTime-xreader.lastReaderTapTime)<250){xreader.callAppMethod("ToggleMenu")}},onTap:function(ev,iframeEvent){var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
var eventComesFromRealClick=e.isTrusted==!0||e.x!=0||e.y!=0;var neverShowMenuObjects=["textarea","input","button","select","label",];if(e.defaultPrevented||!eventComesFromRealClick||xreader.wasDraggingPage||(e.target!=null&&neverShowMenuObjects.indexOf(e.target.localName)>=0)){xreader.wasDraggingPage=!1;xreader.touchActionDefaultPrevented=!0;return!1}
neverSwipeObjects=["video","audio"];if(e.target!=null&&neverSwipeObjects.indexOf(e.target.localName)>=0&&e.target.controls){xreader.wasDraggingPage=!1;xreader.touchActionDefaultPrevented=!0;return!1}
xreader.handleReaderTouchAction(e)},onKeyDown:function(ev,iframeEvent){var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
var neverShowMenuObjects=["textarea","input"];if(e.defaultPrevented||xreader.isTurningPages||(e.target!=null&&neverShowMenuObjects.indexOf(e.target.localName)>=0)){return!1}
if(xreader.ReaderSettings.EnableSwipeToNavigate||xreader.ReaderSettings.EnableNavigationArrows){if(e.keyCode==39){xreader.callAppMethod("GoToPageAtRight",[])}else if(e.keyCode==37){xreader.callAppMethod("GoToPageAtLeft",[])}}},onTouchStart:function(ev,iframeEvent){xreader.touchStartTime=Date.now();xreader.touchActionDefaultPrevented=!0;var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
if(e.defaultPrevented||xreader.isTurningPages){return!1}
var neverSwipeObjects=["textarea","input"];if(e.target!=null&&neverSwipeObjects.indexOf(e.target.localName)>=0&&$(e.target).is(":focus")){return!1}
neverSwipeObjects=["audio"];if(e.target!=null&&neverSwipeObjects.indexOf(e.target.localName)>=0&&e.target.controls){return!1}
neverSwipeObjects=["video"];if(e.target!=null&&neverSwipeObjects.indexOf(e.target.localName)>=0&&e.target.controls){return!1}
if(e.target!=null){var el=e.target;while(el!=null&&!el.classList.contains("SCContent")&&!el.classList.contains("SCOverlay")&&!el.classList.contains("SCPage")&&el.nodeName!="body"){var cs=window.getComputedStyle(el);if(cs["overflow-x"]=="scroll"){xreader.canDragPage=!1;return!1}
el=el.parentElement}}
if(xreader.ReaderSettings.EnableSwipeToNavigate&&e.type=="touchstart"&&e.touches.length==1&&!xreader.getWindowZoomedByUser()){xreader.cancelPageSwitch(!1);xreader.wasDraggingPage=!1;xreader.draggingPage=!1;xreader.canDragPage=!0;xreader.touchMoves=0;xreader.touchStartX=e.changedTouches[0].screenX;xreader.touchStartY=e.changedTouches[0].screenY;xreader.currentDragX=0}
xreader.touchActionDefaultPrevented=!1},onTouchMove:function(ev,iframeEvent){var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
if(e.defaultPrevented){return!1}
if(e.type=="touchmove"&&e.view.getSelection().toString().length>0){console.log("touchMove canceled to allow drag-to-select-text");return!1}
if(e.touches.length==1&&xreader.canDragPage){xreader.touchMoves++;var multiplier=xreader.Environment.Platform==xreader.Platform.Android?xreader.containerHeight/screen.height:1.0;var dx=(e.changedTouches[0].screenX-xreader.touchStartX)*multiplier;var dy=(e.changedTouches[0].screenY-xreader.touchStartY)*multiplier;if(xreader.touchMoves>1){}
if(!xreader.draggingPage){if(Math.abs(dx)<=Math.abs(dy))return;if(Math.abs(dx)<10)return;if(xreader.getWindowZoomedByUser())return}
if(!(e.ownerDocument==document&&e.target.id=="overlay"))
e.preventDefault();xreader.draggingPage=!0;var prepareWrapperOne=$("#ReaderPageOne").css("opacity")=="1"&&$("#ReaderPageOne").css("display")=="block";var prepareWrapperTwo=$("#ReaderPageTwo").css("opacity")=="1"&&$("#ReaderPageTwo").css("display")=="block";if(xreader.currentDragX<=0&&dx>0){if(prepareWrapperOne)
document.getElementById("ReaderPageOneWrapper").style.backgroundImage=document.getElementById("ReaderLeftThumbnailOne").style.backgroundImage;if(prepareWrapperTwo)
document.getElementById("ReaderPageTwoWrapper").style.backgroundImage=document.getElementById("ReaderLeftThumbnailTwo").style.backgroundImage}else if(xreader.currentDragX>=0&&dx<0){if(prepareWrapperOne)
document.getElementById("ReaderPageOneWrapper").style.backgroundImage=document.getElementById("ReaderRightThumbnailOne").style.backgroundImage;if(prepareWrapperTwo)
document.getElementById("ReaderPageTwoWrapper").style.backgroundImage=document.getElementById("ReaderRightThumbnailTwo").style.backgroundImage}
xreader.currentDragX=dx;document.getElementById("container").style.webkitTransform="translate3d("+dx+"px, 0, 0)"}},onTouchEnd:function(ev,iframeEvent){xreader.canDragPage=!1;var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
if(e.defaultPrevented){xreader.touchActionDefaultPrevented=!0;return!0}
var ms=Date.now()-xreader.touchStartTime;var speed=Math.abs(xreader.currentDragX)/xreader.containerWidth/(ms/1000);if(xreader.draggingPage){var currentPageDx=0;if(ms<500&&speed>0.8){currentPageDx=-xreader.currentDragX/Math.abs(xreader.currentDragX)}else if(xreader.currentDragX>xreader.containerWidth/2){currentPageDx=-1}else if(xreader.currentDragX<-xreader.containerWidth/2){currentPageDx=1}
if(currentPageDx>0&&xreader.canDragPageLeft){xreader.turnPagesRightAnimated()}else if(currentPageDx<0&&xreader.canDragPageRight){xreader.turnPagesLeftAnimated()}else{xreader.cancelPageSwitch(!0);$("#overlay").hide()}
e.preventDefault();xreader.draggingPage=!1;xreader.wasDraggingPage=!0;setTimeout(function(){xreader.wasDraggingPage=!1},500);return}
if(!xreader.touchActionDefaultPrevented&&Date.now()-xreader.touchStartTime<250){xreader.handleReaderTouchAction(e)}},onWheel:function(ev,iframeEvent){var e;if(iframeEvent!=null){e=iframeEvent;if(iframeEvent.defaultPrevented)e.preventDefault();}else{e=ev.originalEvent;if(ev.defaultPrevented)e.preventDefault();}
if(xreader.getWindowZoomedByUser())return;if(!xreader.ReaderSettings.EnableSwipeToNavigate)return;var ms=Date.now()-xreader.wheelTime;xreader.wheelTime=Math.max(Date.now(),xreader.wheelTime);if(ms<0||ms>300||Math.abs(e.deltaX)<20||xreader.isTurningPages){xreader.accWheelX=0;xreader.accWheelY=0;return}
xreader.accWheelX+=e.deltaX;xreader.accWheelY+=e.deltaY;if(Math.abs(xreader.accWheelX)>500&&Math.abs(xreader.accWheelY)<100){var x=xreader.accWheelX;xreader.accWheelX=0;xreader.accWheelY=0;xreader.wheelTime=Date.now()+800;if(x>0){xreader.callAppMethod("GoToPageAtRight",[])}else{xreader.callAppMethod("GoToPageAtLeft",[])}}},adjustInterface:function(customWidth,customHeight){if(customWidth!=null&&customHeight!=null){xreader.containerWidth=customWidth;xreader.containerHeight=customHeight}else{if(window.innerWidth==window.innerHeight){setTimeout(xreader.adjustInterface,100);return}
if(xreader.getWindowZoomedByUser()){xreader.containerWidth=document.documentElement.clientWidth;xreader.containerHeight=document.documentElement.clientHeight}else{xreader.containerWidth=window.innerWidth;xreader.containerHeight=window.innerHeight}}
$("#spread").css("width",xreader.containerWidth+"px");$("#spread").css("height",xreader.containerHeight+"px");$("#container").css("width",xreader.containerWidth+"px");$("#container").css("height",xreader.containerHeight+"px");$("#overlay").css("width",xreader.containerWidth+"px");$("#overlay").css("height",xreader.containerHeight+"px");var pageOneColumn=document.getElementById("ReaderPageOneColumn");var pageTwoColumn=document.getElementById("ReaderPageTwoColumn");var leftThumbnailOne=document.getElementById("ReaderLeftThumbnailOne");var leftThumbnailTwo=document.getElementById("ReaderLeftThumbnailTwo");var leftThumbnailOneColumn=document.getElementById("ReaderLeftThumbnailOneColumn");var leftThumbnailTwoColumn=document.getElementById("ReaderLeftThumbnailTwoColumn");var rightThumbnailOne=document.getElementById("ReaderRightThumbnailOne");var rightThumbnailTwo=document.getElementById("ReaderRightThumbnailTwo");var rightThumbnailOneColumn=document.getElementById("ReaderRightThumbnailOneColumn");var rightThumbnailTwoColumn=document.getElementById("ReaderRightThumbnailTwoColumn");var pageOneWrapper=document.getElementById("ReaderPageOneWrapper");var pageOne=document.getElementById("ReaderPageOne");var pageTwoWrapper=document.getElementById("ReaderPageTwoWrapper");var pageTwo=document.getElementById("ReaderPageTwo");var doublePageItemsVisibility="hidden";var doublePageItemsDisplay="none";if(xreader.isDoublePage){pageOneColumn.style.width="50%";leftThumbnailOneColumn.style.width="50%";rightThumbnailOneColumn.style.width="50%";doublePageItemsVisibility="visible";doublePageItemsDisplay="block"}else{pageOneColumn.style.width="100%";leftThumbnailOneColumn.style.width="100%";rightThumbnailOneColumn.style.width="100%"}
pageTwoColumn.style.visibility=doublePageItemsVisibility;pageTwoColumn.style.display=doublePageItemsDisplay;leftThumbnailTwoColumn.style.visibility=doublePageItemsVisibility;leftThumbnailTwoColumn.style.display=doublePageItemsDisplay;rightThumbnailTwoColumn.style.visibility=doublePageItemsVisibility;rightThumbnailTwoColumn.style.display=doublePageItemsDisplay;var cw=Math.round(xreader.containerWidth/(xreader.isDoublePage?2:1));var ch=xreader.containerHeight;if(xreader.pageH/xreader.pageW<ch/cw){xreader.pageZoom=cw/xreader.pageW}else{xreader.pageZoom=ch/xreader.pageH}
var wrapperWidth=xreader.pageW*xreader.pageZoom;var wrapperHeight=xreader.pageH*xreader.pageZoom;$(".ReaderPageWrapper").css("width",wrapperWidth+"px");$(".ReaderPageWrapper").css("height",wrapperHeight+"px");$(".ReaderPageWrapper").css("top",Math.round((ch-wrapperHeight)/2)+"px");var wrappersOneX=Math.round((cw-wrapperWidth)/2)+"px";var wrappersTwoX=wrappersOneX;if(xreader.isDoublePage){wrappersOneX=cw-wrapperWidth+"px";wrappersTwoX="0px"}
pageOneWrapper.style.left=wrappersOneX;pageTwoWrapper.style.left=wrappersTwoX;leftThumbnailOne.style.left=wrappersOneX;leftThumbnailTwo.style.left=wrappersTwoX;rightThumbnailOne.style.left=wrappersOneX;rightThumbnailTwo.style.left=wrappersTwoX;$(".ReaderPage").css("width",xreader.pageW+"px");$(".ReaderPage").css("height",xreader.pageH+"px");$(".ReaderPage").css("webkit-transform","scale("+xreader.pageZoom+")")},load:function(readerSettings,w,h,pageOne,pageTwo,thumbOne,thumbTwo,thumbRightOne,thumbRightTwo,thumbLeftOne,thumbLeftTwo){xreader.isTurningPages=!1;xreader.isDoublePage=readerSettings.EnableDoublePage;xreader.pageW=w;xreader.pageH=h;xreader.ReaderSettings=readerSettings;xreader.Hooks._beforeNavigationHooks.forEach((hook,hookIndex)=>{if(typeof hook==="function"){try{hook(pageOne,pageTwo)}catch(error){console.error(error)}}});if(!xreader.draggingPage)$("#overlay").show();var metaViewportContent="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=6";if(!readerSettings.EnablePinchToZoom)
metaViewportContent+=", user-scalable=no";if(readerSettings.ViewportFitCover)
metaViewportContent+=", viewport-fit=cover";document.querySelector("meta[name=viewport]").setAttribute("content",metaViewportContent);if(xreader.Environment.Platform==xreader.Platform.iOS){xreader.adjustInterface(readerSettings.WebViewWidth,readerSettings.WebViewHeight)}else{xreader.adjustInterface()}
var pageOneWrapper=document.getElementById("ReaderPageOneWrapper");var pageOneContainer=document.getElementById("ReaderPageOne");var pageTwoWrapper=document.getElementById("ReaderPageTwoWrapper");var pageTwoContainer=document.getElementById("ReaderPageTwo");pageOneWrapper.style.backgroundImage="url('"+thumbOne+"')";pageTwoWrapper.style.backgroundImage="url('"+thumbTwo+"')";if(pageOne==null||pageOne==""){$(pageOneContainer).hide();$(".SCLoader",pageOneWrapper).hide();pageOneContainer.contentWindow.location.replace("about:blank")}else{pageOneContainer.contentWindow.location.replace(pageOne);$(pageOneContainer).css("opacity","0.001");$(pageOneContainer).show();setTimeout(function(){if($(pageOneContainer).css("display")!="none"&&$(pageOneContainer).css("opacity")!="1"&&pageOneContainer.contentWindow.location.href==pageOne){$(".SCLoader",pageOneWrapper).show()}},2000)}
if(pageTwo==null||pageTwo==""){$(pageTwoContainer).hide();$(".SCLoader",pageTwoWrapper).hide();pageTwoContainer.contentWindow.location.replace("about:blank")}else{pageTwoContainer.contentWindow.location.replace(pageTwo);$(pageTwoContainer).css("opacity","0.001");$(pageTwoContainer).show();setTimeout(function(){if($(pageTwoContainer).css("display")!="none"&&$(pageTwoContainer).css("opacity")!="1"&&pageTwoContainer.contentWindow.location.href==pageTwo){$(".SCLoader",pageTwoWrapper).show()}},2000)}
document.getElementById("container").style.webkitTransform="translate3d(0px, 0, 0)";document.getElementById("container").style.transform="";setTimeout(function(){document.getElementById("ReaderLeftThumbnailOne").style.backgroundImage="url('"+thumbLeftOne+"')";document.getElementById("ReaderLeftThumbnailTwo").style.backgroundImage="url('"+thumbLeftTwo+"')";document.getElementById("ReaderRightThumbnailOne").style.backgroundImage="url('"+thumbRightOne+"')";document.getElementById("ReaderRightThumbnailTwo").style.backgroundImage="url('"+thumbRightTwo+"')";xreader.initReaderPage(pageOneContainer,pageOne,xreader.pageInstanceID++)},25);setTimeout(function(){xreader.initReaderPage(pageTwoContainer,pageTwo,xreader.pageInstanceID++)},125)},initReaderPage:function(iframeElement,src,pagePageInstanceId){if(src==null||src.length==0)return;if(iframeElement.contentWindow!=null&&iframeElement.contentWindow.location!=null&&iframeElement.contentWindow.location.href!=null&&iframeElement.contentWindow.document!=null&&iframeElement.contentWindow.document.body!=null&&iframeElement.contentWindow.document.body.getAttribute("XReaderPagePageInstanceId")!=null&&iframeElement.contentWindow.document.body.getAttribute("XReaderPagePageInstanceId")>pagePageInstanceId){return}
if(iframeElement.contentWindow==null||iframeElement.contentWindow.location==null||iframeElement.contentWindow.location.href==null||iframeElement.contentWindow.location.href!=src||iframeElement.contentWindow.document==null||iframeElement.contentWindow.document.body==null||iframeElement.contentWindow.document.body.childElementCount==0||iframeElement.contentWindow.document.body.getAttribute("XReaderPagePageInstanceId")!=null){setTimeout(function(){xreader.initReaderPage(iframeElement,src,pagePageInstanceId)},100);return}
var iframeWindow=iframeElement.contentWindow;var iframeDocument=iframeWindow.document;var iframeBody=iframeDocument.body;iframeBody.setAttribute("XReaderPagePageInstanceId",pagePageInstanceId);var forwardEventToXReader=function(e){$("body").trigger(e.type,[e])};iframeBody.addEventListener("touchstart",forwardEventToXReader);iframeBody.addEventListener("touchmove",forwardEventToXReader);iframeBody.addEventListener("touchend",forwardEventToXReader);iframeBody.addEventListener("mousedown",forwardEventToXReader);iframeBody.addEventListener("mousemove",forwardEventToXReader);iframeBody.addEventListener("mouseup",forwardEventToXReader);iframeBody.addEventListener("click",function(e){$("#container").trigger(e.type,[e])});iframeWindow.addEventListener("keydown",function(e){$(window).trigger("keydown",[e])});iframeWindow.addEventListener("wheel",function(e){$(window).trigger("wheel",[e])});var pageIframes=iframeBody.getElementsByTagName("iframe");$.each(pageIframes,function(index,item){item.onload=function(){var w=item.contentWindow;w.addEventListener("touchend",function(e){$("body").trigger("touchend",[e])});w.addEventListener("touchmove",function(e){$("body").trigger("touchmove",[e])});w.addEventListener("touchstart",function(e){$("body").trigger("touchstart",[e])});w.addEventListener("click",function(e){if(e.defaultPrevented){e.stopPropagation();return!0}
$("#container").trigger("click",[e])});w.addEventListener("keydown",function(e){$(window).trigger("keydown",[e])});var internalIframeDocument=w.document;var internalIframeInjectedCss="* { -webkit-tap-highlight-color: transparent; }";var internalIframeInjectedStyleNode=internalIframeDocument.createElement("style");internalIframeInjectedStyleNode.innerHTML=internalIframeInjectedCss;internalIframeDocument.head.appendChild(internalIframeInjectedStyleNode)}});var oXPUB=new XPUB(iframeElement);iframeElement.contentWindow.XPUB=oXPUB;iframeElement.contentWindow.xreader=xreader;var links=Array.prototype.slice.call(iframeDocument.getElementsByTagName("a"));var count=links.length;for(var i=0;i<count;i++){links[i].addEventListener("click",function(e){e.preventDefault();if(xreader.wasDraggingPage){xreader.wasDraggingPage=!1}else{oXPUB.openUrl(this.href,!1)}
return!0})}
if(xreader.ReaderSettings.EnableTapToSeekReadaloud){$(iframeBody.getElementsByClassName("SCReadaloudBlock")).click(function(e){if(!xreader.MediaOverlay.IsPlaying)return;if(e.isDefaultPrevented()){e.stopPropagation();return!0}else{e.preventDefault()}
oXPUB.seekReadaloud(this.id)})}
var injectedCss="* { -webkit-tap-highlight-color: transparent; }";var injectedStyleNode=iframeDocument.createElement("style");injectedStyleNode.innerHTML=injectedCss;iframeDocument.head.appendChild(injectedStyleNode);if(xreader.orientation!=undefined)
xreader.setOrientation(xreader.orientation);xreader.Hooks._beforePageLoadHooks.forEach((hook,hookIndex)=>{if(typeof hook==="function"){try{hook(src)}catch(error){console.error(error)}}});var event=document.createEvent("Event");event.initEvent("SCEventPageLoad",!1,!0);iframeElement.contentWindow.dispatchEvent(event)},cancelPageSwitch:function(animated){if(animated==!0){$("#container").transition({x:0},400,"snap")}else{document.getElementById("container").style.webkitTransform="translate3d(0px, 0, 0)";document.getElementById("container").style.transform=""}},turnPagesRightAnimated:function(onCompletionFunction){if(xreader.isTurningPages&&onCompletionFunction!=null){onCompletionFunction();return}
xreader.isTurningPages=!0;if(onCompletionFunction==null){onCompletionFunction=function(){xreader.callAppMethod("GoToPageAtRight",[])}}else{document.getElementById("ReaderPageOneWrapper").style.backgroundImage=document.getElementById("ReaderRightThumbnailOne").style.backgroundImage;document.getElementById("ReaderPageTwoWrapper").style.backgroundImage=document.getElementById("ReaderRightThumbnailTwo").style.backgroundImage}
$("#container").transition({x:-xreader.containerWidth},150,"out",onCompletionFunction)},turnPagesLeftAnimated:function(onCompletionFunction){if(xreader.isTurningPages&&onCompletionFunction!=null){onCompletionFunction();return}
xreader.isTurningPages=!0;if(onCompletionFunction==null){onCompletionFunction=function(){xreader.callAppMethod("GoToPageAtLeft",[])}}else{document.getElementById("ReaderPageOneWrapper").style.backgroundImage=document.getElementById("ReaderLeftThumbnailOne").style.backgroundImage;document.getElementById("ReaderPageTwoWrapper").style.backgroundImage=document.getElementById("ReaderLeftThumbnailTwo").style.backgroundImage}
$("#container").transition({x:xreader.containerWidth},150,"out",onCompletionFunction)},getPageContentWindow:function(pageSrc){var iframeOne=document.getElementById("ReaderPageOne");if(iframeOne.contentWindow.location.href==pageSrc){return iframeOne.contentWindow}
var iframeTwo=document.getElementById("ReaderPageTwo");if(iframeTwo.contentWindow.location.href==pageSrc){return iframeTwo.contentWindow}
return null},applyMediaOverlay:function(enabled,pageSrc=null,elementId=null,isPlayingAudio=null){if(isPlayingAudio==null)isPlayingAudio=enabled;xreader.MediaOverlay.IsPlaying=enabled;xreader.MediaOverlay.IsPlayingAudio=isPlayingAudio;xreader.MediaOverlay.CurrentElement=elementId;var iframeOne=document.getElementById("ReaderPageOne");var iframeTwo=document.getElementById("ReaderPageTwo");var eventToTrigger=enabled?"SCEventReadAloudStarted":"SCEventReadAloudStopped";[iframeOne,iframeTwo].forEach(function(iframe){try{$(iframe.contentWindow.document.getElementsByClassName(xreader.MediaOverlay.ActiveElementClass)).removeClass(xreader.MediaOverlay.ActiveElementClass);iframe.contentWindow.XPUB.isReadAloudPlayingAudio=isPlayingAudio;if(iframe.contentWindow.XPUB.isReadAloudActive!=enabled){iframe.contentWindow.XPUB.isReadAloudActive=enabled;iframe.contentWindow.$(".SCPageObject").trigger(eventToTrigger)}}catch(err){}});if(!enabled||elementId==null)return;var pageContentWindow=xreader.getPageContentWindow(pageSrc);if(pageContentWindow==null)return;$(pageContentWindow.document.getElementById(elementId)).addClass(xreader.MediaOverlay.ActiveElementClass)},executeJavascript:function(pageSrc,fn){if(pageSrc=="*"){var iframeOne=document.getElementById("ReaderPageOne");var iframeTwo=document.getElementById("ReaderPageTwo");try{if(iframeOne.contentWindow.location.href!="about:blank")
xreader.executeJavascript(iframeOne.contentWindow.location.href,fn);}finally{if(iframeTwo.contentWindow.location.href!="about:blank")
xreader.executeJavascript(iframeTwo.contentWindow.location.href,fn);}}else{var pageContentWindow=xreader.getPageContentWindow(pageSrc);if(pageContentWindow==null)return;pageContentWindow.tmpExecJsFn=fn;pageContentWindow.tmpExecJsFn(pageContentWindow.$,pageContentWindow,pageContentWindow.document)}},callAppMethod:function(methodName,methodParameters,callbackFn,errorFn){if(typeof jsBridge==="undefined"){setTimeout(function(){xreader.callAppMethod(methodName,methodParameters,callbackFn,errorFn)},200);return}
if(methodParameters==null){methodParameters=[]}else if(!Array.isArray(methodParameters)){methodParameters=[methodParameters]}
xreader.sentMsgID++;if(typeof callbackFn==="undefined")callbackFn=null;if(typeof errorFn==="undefined")errorFn=null;if(callbackFn!=null){var msg={method:methodName,params:methodParameters,callbackFn:callbackFn,errorFn:errorFn,id:xreader.sentMsgID,};xreader.messagesAwaitingResponse.push(msg);jsBridge.invokeAction(JSON.stringify({method:methodName,params:methodParameters,callbackFn:""+callbackFn,errorFn:""+errorFn,id:xreader.sentMsgID,}))}else{jsBridge.invokeAction(JSON.stringify({method:methodName,params:methodParameters,callbackFn:null,errorFn:null,id:xreader.sentMsgID,}))}},invokeAppCallback:function(msgId,response,err){var msg;for(var i=0;i<xreader.messagesAwaitingResponse.length;i++){msg=xreader.messagesAwaitingResponse[i];if(msg.id==msgId){if(err!=null){if(msg.errorFn)msg.errorFn(err);}else{if(msg.callbackFn)msg.callbackFn(response);}
xreader.messagesAwaitingResponse.splice(i,1);break}}},backupUserData:function(indexedDBs){var values={},keys=Object.keys(localStorage),i=keys.length;while(i--){values[keys[i]]=localStorage.getItem(keys[i])}
var localStorageData=JSON.stringify(values);var nativeStorageData=JSON.stringify(xreader.NativeStorage.data);var idbData=[];var idbCount=indexedDBs!=null?indexedDBs.length:0;var idbBackedUp=0;var idbStoresCount=0;var idbStoresBackedUp=0;if(idbCount>0&&xreader.Environment.Platform!=xreader.Platform.Windows){var checkCompleted=function(){console.log(idbBackedUp+" of "+idbCount+" databases; "+idbStoresBackedUp+" of "+idbStoresCount+" objectStores");if(idbBackedUp==idbCount&&idbStoresCount==idbStoresBackedUp){var indexedDbData=JSON.stringify(idbData);console.log(idbData);xreader.callAppMethod("BackupUserData",[localStorageData,indexedDbData,nativeStorageData,])}};indexedDBs.forEach((dbName)=>{try{var request=indexedDB.open(dbName);request.onsuccess=function(event){try{var db=event.target.result;var dbBackup={name:db.name,version:db.version,objectStores:[],};idbStoresCount=idbStoresCount+db.objectStoreNames.length;for(let i=0;i<db.objectStoreNames.length;i++){try{const objectStoreName=db.objectStoreNames[i];var transaction=db.transaction(objectStoreName,"readonly");var objectStore=transaction.objectStore(objectStoreName);req=objectStore.getAll();req.onsuccess=function(event){try{var objectStoreBackup={name:objectStoreName,autoIncrement:objectStore.autoIncrement,keyPath:objectStore.keyPath,items:event.target.result,};dbBackup.objectStores.push(objectStoreBackup)}catch(error){}
idbStoresBackedUp++;checkCompleted()};req.onerror=function(event){idbStoresBackedUp++;checkCompleted()}}catch(error){idbStoresBackedUp++;checkCompleted()}}
idbData.push(dbBackup);idbBackedUp++;checkCompleted()}catch(error){idbBackedUp++;checkCompleted()}};request.onerror=function(event){idbBackedUp++;checkCompleted()}}catch(error){idbBackedUp++;checkCompleted()}})}else{var indexedDbData=JSON.stringify(idbData);xreader.callAppMethod("BackupUserData",[localStorageData,indexedDbData,nativeStorageData,])}},restoreUserData:function(localStorageBackup,indexedDbBackup,nativeStorageBackup){if(localStorageBackup!=null){var keys=Object.keys(localStorageBackup),i=keys.length;localStorage.clear();while(i--){localStorage.setItem(keys[i],localStorageBackup[keys[i]])}}
if(indexedDbBackup!=null&&xreader.Environment.Platform!=xreader.Platform.Windows){indexedDbBackup.forEach((dbBackup)=>{try{var restoreDatabase=function(){indexedDB.open(dbBackup.name,dbBackup.version).onupgradeneeded=function(event){var db=event.target.result;dbBackup.objectStores.forEach((objectStoreBackup)=>{var objectStore=db.createObjectStore(objectStoreBackup.name,{keyPath:objectStoreBackup.keyPath,autoIncrement:objectStoreBackup.autoIncrement,});objectStore.transaction.oncomplete=function(event){var objectStore=db.transaction(objectStoreBackup.name,"readwrite").objectStore(objectStoreBackup.name);objectStoreBackup.items.forEach((item)=>{objectStore.add(item)})}})}};var request=indexedDB.deleteDatabase(dbBackup.name);request.onerror=restoreDatabase;request.onsuccess=restoreDatabase}catch(error){console.error("error restoring database",dbBackup.name)}})}
if(nativeStorageBackup!=null){xreader.NativeStorage.data=nativeStorageBackup}},};function XPUB(iframeElement){this.iframeElement=iframeElement;this.xpubWindow=this.iframeElement.contentWindow;this.pageUrl=this.xpubWindow.location.href;this.readerUrl=window.location.href;this.parentDocument=document;this.readerPrefersToHandleAudio=xreader.Environment.Platform==xreader.Platform.iOS||(xreader.Environment.Platform==xreader.Platform.Web&&typeof window.AudioContext!=="undefined")||typeof window.webkitAudioContext!=="undefined";this.currentUsername=xreader.Environment.CurrentUsername;this.currentDeviceId=xreader.Environment.CurrentDeviceId;this.productId=xreader.Environment.ProductId}
XPUB.prototype.callAppMethod=function(methodName,methodParameters,callbackFn,errorFn){methodName="XPUB."+methodName;if(methodParameters==null){methodParameters=[]}else if(!Array.isArray(methodParameters)){methodParameters=[methodParameters]}
methodParameters.unshift(this.pageUrl);xreader.callAppMethod(methodName,methodParameters,callbackFn,errorFn)};XPUB.prototype.callNative=XPUB.prototype.callAppMethod;XPUB.prototype.ready=function(){var caller=this;setTimeout(function(){if(caller.iframeElement.contentWindow.location.href!=caller.pageUrl)
return;caller.iframeElement.contentWindow.showAssetsParity("all");xreader.Hooks._beforePagePlayHooks.forEach((hook,hookIndex)=>{if(typeof hook==="function"){try{hook(caller.pageUrl)}catch(error){console.error(error)}}});var event=caller.parentDocument.createEvent("Event");event.initEvent("SCEventPagePlay",!1,!0);caller.xpubWindow.dispatchEvent(event);$(caller.iframeElement).css("opacity","1");$(".SCLoader",$(caller.iframeElement.parentElement)).hide();caller.callAppMethod("Ready");if(!xreader.draggingPage)$("#overlay").hide();window.lastXpub=caller},250)};XPUB.prototype.openUrl=function(url,openInBrowser){this.callAppMethod("OpenUrl",[url,openInBrowser])};XPUB.prototype.openMenu=function(){this.callAppMethod("OpenMenu")};XPUB.prototype.playAudio=function(url,playFromBeginning,objectIdInPage){this.callAppMethod("PlayAudio",[url,playFromBeginning,objectIdInPage])};XPUB.prototype.initDeviceMotion=function(){this.callAppMethod("InitDeviceMotion",[])};XPUB.prototype.pauseAllMedia=function(){var $=this.xpubWindow.$;$("audio,video").each(function(index){var myMedia=$(this)[0];if(myMedia.duration>0&&!myMedia.paused){$(this).attr("data-mediaPausedByXPUB","true");try{myMedia.pause()}catch(err){}}})};XPUB.prototype.resumeAllMedia=function(){var $=this.xpubWindow.$;var doc=this.xpubWindow.document;$(doc).find("[data-mediaPausedByXPUB='true']").each(function(index){$(this).attr("data-mediaPausedByXPUB","false");var myMedia=$(this)[0];try{myMedia.play()}catch(err){}})};XPUB.prototype.openLocalizationsMenu=function(){this.callAppMethod("OpenLocalizationsMenu")};XPUB.prototype.startStopReadAloud=function(event){this.callAppMethod("StartStopReadAloud");event.preventDefault()};XPUB.prototype.seekReadaloud=function(blockId){this.callAppMethod("SeekReadaloud",[blockId])};XPUB.prototype.toggleSoundtrack=function(){this.callAppMethod("ToggleSoundtrack")};XPUB.prototype.startSoundtrack=function(){this.callAppMethod("StartSoundtrack")};XPUB.prototype.stopSoundtrack=function(){this.callAppMethod("StopSoundtrack")};XPUB.prototype.startAnnotationMode=function(){this.callAppMethod("StartAnnotationMode")};XPUB.prototype.stopAnnotationMode=function(){this.callAppMethod("StopAnnotationMode")};XPUB.prototype.close=function(){this.callAppMethod("Close")};XPUB.prototype.find=function(keyword){this.clearSearchResults();this.findInElement(this.xpubWindow.document.body,keyword)};XPUB.prototype.findInElement=function(element,keyword){var doc=this.xpubWindow.document;if(element){if(element.nodeType==3){while(!0){var value=element.nodeValue;var idx=value.toLowerCase().indexOf(keyword.toLowerCase());if(idx<0)break;var span=doc.createElement("span");var text=doc.createTextNode(value.substr(idx,keyword.length));span.appendChild(text);span.setAttribute("class","MyAppHighlight");span.style.backgroundColor="yellow";span.style.color="black";text=doc.createTextNode(value.substr(idx+keyword.length));element.deleteData(idx,value.length-idx);var next=element.nextSibling;element.parentNode.insertBefore(span,next);element.parentNode.insertBefore(text,next);element=text}}else if(element.nodeType==1){if(element.style.display!="none"&&element.nodeName.toLowerCase()!="select"){for(var i=element.childNodes.length-1;i>=0;i--){this.findInElement(element.childNodes[i],keyword)}}}}};XPUB.prototype.clearSearchResults=function(){this.clearSearchResultsFromElement(this.xpubWindow.document.body)};XPUB.prototype.clearSearchResultsFromElement=function(element){if(element){if(element.nodeType==1){if(element.getAttribute("class")=="MyAppHighlight"){var text=element.removeChild(element.firstChild);element.parentNode.insertBefore(text,element);element.parentNode.removeChild(element);return!0}else{var normalize=!1;for(var i=element.childNodes.length-1;i>=0;i--){if(this.clearSearchResultsFromElement(element.childNodes[i])){normalize=!0}}
if(normalize){element.normalize()}}}}
return!1};XPUB.prototype.getOrientation=function(){return xreader.overriddenOrientation!=null?xreader.overriddenOrientation:window.orientation};XPUB.prototype.sendMail=function(recipient,subject,content){this.callAppMethod("SendMail",[recipient,subject,content])};XPUB.prototype.takePhoto=function(){this.callAppMethod("TakePhoto")};XPUB.prototype.pickPhoto=function(){this.callAppMethod("PickPhoto")};XPUB.prototype.scanQr=function(){this.callAppMethod("ScanQr")};XPUB.prototype.getProductCover=function(itemId,callbackFn,errorFn){this.callAppMethod("GetProductCover",itemId,callbackFn,errorFn)};XPUB.prototype.openProductDetails=function(itemId){this.callAppMethod("OpenProductDetails",itemId)};XPUB.prototype.isReadAloudActive=!1;XPUB.prototype.isReadAloudPlayingAudio=!1;XPUB.prototype.readerPrefersToHandleAudio;XPUB.prototype.injectElement=function(elementType,attributes,dest){var doc=this.xpubWindow.document;var myHeader=doc.createElement(elementType);attributes.forEach((attr)=>{myHeader.setAttribute(attr.name,attr.value)});if(dest=="head"){doc.head.appendChild(myHeader)}else{doc.body.appendChild(myHeader)}};XPUB.prototype.injectStylesheet=function(src){this.injectElement("link",[{name:"rel",value:"stylesheet"},{name:"type",value:"text/css"},{name:"href",value:src},],"head")};XPUB.prototype.injectScript=function(src){this.injectElement("script",[{name:"type",value:"text/javascript"},{name:"src",value:src},],"body")};window.PubViewer=xreader;if(document.location.protocol!="file:"&&navigator.userAgent.indexOf("MSIE ")<0&&navigator.userAgent.indexOf("Trident/")<0){xreader.init()}